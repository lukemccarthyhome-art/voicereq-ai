<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>All Sessions - Morti Projects Admin</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <style>
        :root { --bg-deep: #050d1a; --bg-glass: rgba(15, 29, 50, 0.6); --border-glass: rgba(255, 255, 255, 0.08); --border-glass-hover: rgba(255, 255, 255, 0.15); --accent: #1199fa; --accent-glow: rgba(17, 153, 250, 0.4); --accent-dim: rgba(17, 153, 250, 0.12); --accent-secondary: #00d4aa; --text-primary: #f0f4f8; --text-secondary: rgba(240, 244, 248, 0.7); --text-muted: rgba(240, 244, 248, 0.4); --radius: 16px; --radius-pill: 50px; }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif; background: var(--bg-deep); color: var(--text-primary); line-height: 1.6; -webkit-font-smoothing: antialiased; }
        a { text-decoration: none; color: inherit; }
        .main { max-width: 1200px; margin: 0 auto; padding: 24px; min-height: calc(100vh - 200px); }
        .card { background: var(--bg-glass); backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px); border: 1px solid var(--border-glass); border-radius: var(--radius); padding: 24px; margin-bottom: 20px; }
        .btn { display: inline-flex; align-items: center; justify-content: center; padding: 10px 24px; border-radius: var(--radius-pill); font-size: 0.88rem; font-weight: 600; cursor: pointer; transition: all 0.3s; border: none; color: #fff; text-decoration: none; background: var(--accent); box-shadow: 0 0 20px var(--accent-glow); }
        .btn:hover { background: #2aa8ff; transform: translateY(-1px); }
        .btn-sm { padding: 6px 14px; font-size: 0.78rem; }
        .btn-success { background: var(--accent-secondary); box-shadow: 0 0 16px rgba(0,212,170,0.3); }
        .table { width: 100%; border-collapse: collapse; margin-top: 12px; }
        .table th, .table td { text-align: left; padding: 12px; border-bottom: 1px solid var(--border-glass); }
        .table th { background: rgba(15,29,50,0.4); font-weight: 600; color: var(--text-muted); font-size: 0.78rem; text-transform: uppercase; letter-spacing: 0.06em; }
        .table tbody tr:hover { background: rgba(17,153,250,0.05); }
        .filters { display: flex; gap: 12px; align-items: center; margin-bottom: 16px; flex-wrap: wrap; }
        .filters input, .filters select { padding: 8px 12px; border: 1px solid var(--border-glass); border-radius: 12px; font-size: 13px; background: rgba(5,13,26,0.6); color: var(--text-primary); }
        .filters input:focus, .filters select:focus { outline: none; border-color: var(--accent); box-shadow: 0 0 0 3px var(--accent-dim); }
        .status-dot { display: inline-block; width: 8px; height: 8px; border-radius: 50%; margin-right: 6px; }
        .status-active { background: var(--accent-secondary); }
        .status-completed { background: var(--text-muted); }
        .status-paused { background: #ef4444; }
        .empty-state { text-align: center; padding: 60px 20px; color: var(--text-muted); }
        .empty-state .emoji { font-size: 48px; margin-bottom: 16px; display: block; }
    </style>
</head>
<body>
    <%- include('../partials/admin-nav', { currentPage: 'sessions', user: user }) %>

    <main class="main">
        <div class="card">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                <h2 style="font-size:1.3rem;font-weight:700;">üí¨ All Sessions</h2>
                <span style="color: var(--text-muted); font-size: 14px;"><%= sessions.length %> total</span>
            </div>

            <div class="filters">
                <input type="text" id="filterSearch" placeholder="üîç Search project or customer..." oninput="filterTable()" style="min-width: 250px;">
                <select id="filterStatus" onchange="filterTable()">
                    <option value="">All statuses</option>
                    <option value="active">Active</option>
                    <option value="paused">Paused</option>
                    <option value="completed">Completed</option>
                </select>
            </div>

            <% if (sessions.length > 0) { %>
                <table class="table" id="sessionsTable">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Project</th>
                            <th>Customer</th>
                            <th>Messages</th>
                            <th>Files</th>
                            <th>Status</th>
                            <th>Last Activity</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <% sessions.forEach(session => { %>
                            <tr data-project="<%= (session.project_name || '').toLowerCase() %>" data-customer="<%= (session.user_name || '').toLowerCase() %>" data-status="<%= session.status %>">
                                <td><strong>#<%= session.id %></strong></td>
                                <td>
                                    <a href="/admin/projects/<%= encodeId(session.project_id) %>" style="color: var(--accent); font-weight: 500;">
                                        <%= session.project_name %>
                                    </a>
                                </td>
                                <td>
                                    <div style="font-weight: 500;"><%= session.user_name %></div>
                                    <div style="font-size: 12px; color: var(--text-muted);"><%= session.user_email %></div>
                                </td>
                                <td style="color: var(--text-secondary);"><%= session.message_count %></td>
                                <td style="color: var(--text-secondary);"><%= session.file_count %></td>
                                <td>
                                    <span class="status-dot status-<%= session.status %>"></span>
                                    <span style="color: var(--text-secondary);"><%= session.status %></span>
                                </td>
                                <td style="font-size: 13px; color: var(--text-muted);">
                                    <%= melb(session.updated_at) %>
                                </td>
                                <td>
                                    <a href="/admin/sessions/<%= session.id %>/view" class="btn btn-sm" style="margin-right: 4px;">üëÅÔ∏è View</a>
                                    <a href="/voice-session?project=<%= encodeId(session.project_id) %>&session=<%= session.id %>" class="btn btn-sm btn-success">üéôÔ∏è Open</a>
                                </td>
                            </tr>
                        <% }) %>
                    </tbody>
                </table>
            <% } else { %>
                <div class="empty-state">
                    <span class="emoji">üí¨</span>
                    <h3 style="color:var(--text-secondary);">No sessions yet</h3>
                    <p>Sessions will appear here when customers start voice conversations</p>
                </div>
            <% } %>
        </div>
    </main>

    <script>
    function filterTable() {
        const search = document.getElementById('filterSearch').value.toLowerCase();
        const status = document.getElementById('filterStatus').value;
        const rows = document.querySelectorAll('#sessionsTable tbody tr');
        rows.forEach(row => {
            const project = row.dataset.project;
            const customer = row.dataset.customer;
            const rowStatus = row.dataset.status;
            const matchSearch = !search || project.includes(search) || customer.includes(search);
            const matchStatus = !status || rowStatus === status;
            row.style.display = (matchSearch && matchStatus) ? '' : 'none';
        });
    }
    </script>
</body>
</html>
